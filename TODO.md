# Veterans Verify - 动态任务

> 核心目标：**全模式自动化脚本逻辑完善**

**最后更新**: 2026-01-02 12:35 UTC+8

---

## 当前任务

| # | 任务 | 优先级 | 状态 |
|---|------|--------|------|
| 1 | **Camoufox 模式开发** | 🔥高 | 待处理 |
| 2 | **同步 camoufox_verify.py 的 logout/login 逻辑** | 中 | 待处理 |
| 3 | **前端账号来源下拉切换** | 低 | 待处理 |

---

## ✅ 里程碑

| Tag | 模式 | 状态 | 说明 |
|-----|------|------|------|
| `v0.1-cdp-manual` | CDP 手动 | ✅ 可用 | 用户手动登录，脚本自动验证 |
| `v0.2-cdp-auto` | CDP 全自动 | ✅ 可用 | 脚本自动登录/注册 + 验证 |

**回退命令**：`git checkout v0.2-cdp-auto`

---

## 2026-01-02 修复汇总（v0.2-cdp-auto）

| 问题 | 修复 |
|------|------|
| 二次登录（设置弹窗） | 移除 `get_logged_in_account()` 方法3；检测失败时信任当前状态 |
| 验证码获取旧邮件 | Subject 正则加行首锚点；有效期 30→5 分钟 |
| 密码轮换卡住 | 错误残留状态下继续填写新密码 |
| logout 清除 Flask Session | 只清除 chatgpt/openai cookies |

**测试通过**：
- gltn24sgu (新注册) ✅
- tvmo36zbl (已注册) ✅
- pbtb15ocb (全新) ✅

---

## 七种模式

| 模式 | 浏览器 | 账号来源 | 状态 |
|------|--------|---------|------|
| 邮箱池管理 | - | - | ✅ |
| CDP 手动 | Chrome | 临时/自有 | ✅ v0.1 |
| CDP 全自动 | Chrome | 临时邮箱 | ✅ v0.2 |
| Camoufox 可视化 | Firefox | 临时/自有 | ⏸️ 待开发 |
| Camoufox 无头 | Firefox | 临时邮箱 | ⏸️ 待开发 |
| Camoufox 批量 | Firefox | 临时邮箱 | ⏸️ 待开发 |
| Camoufox 自有 | Firefox | 自有账号 | ⏸️ 待开发 |

---

## 开发流程

```bash
# 1. 启动服务
python app.py                           # Flask 7870
scripts\start-chrome-devtools.bat       # Chrome CDP

# 2. 前端操作
访问 http://localhost:7870
选择模式 → 选择邮箱 → 开始验证

# 3. 问题排查
脚本卡住 → MCP 查看页面状态 → 更新选择器
```

---

## 文档

| 文档 | 内容 |
|------|------|
| `CLAUDE.md` | 项目规则、技术栈 |
| `PLAN.md` | 开发计划、进度 |
| `docs/page-selectors.md` | 页面选择器（MCP 验证） |

---

## 历史修复

<details>
<summary>点击展开</summary>

### 2026-01-02

- 二次登录问题（设置弹窗导致）
- 验证码获取旧邮件
- 密码轮换卡住
- logout 清除 Flask Session
- about-you spinbutton 选择器
- 欢迎弹窗误判
- 引导页面处理

### 2026-01-01

- 创建密码页面卡住
- 继续按钮误点
- 新用户引导页面
- auto_login_chatgpt() 状态机

### 2025-12-31

- 验证码页面卡住
- 登录弹窗邮箱输入
- 登录函数重构

### 2025-12-30

- 验证成功后持久化
- 前端自动刷新
- 账号标签功能

</details>

---

## 使用规则

1. **新需求** → 第 1 个任务槽
2. **完成任务** → 移到"已完成"
3. **保持 3 个任务**
4. **核心目标** → 全模式自动化脚本逻辑完善
