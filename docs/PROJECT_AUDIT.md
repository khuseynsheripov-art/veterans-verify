# Veterans Verify - 项目审查报告

> 更新时间: 2025-12-29 09:00 UTC+8
> 目的：整理项目、清理冗余、明确待完成任务

---

## 📋 核心需求确认（来自 CLAUDE.md）

### 三种操作模式（最终版）

```
┌─────────────────────────────────────────────────────────────────────┐
│                      三种操作模式                                   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  📦 模式 1: 邮箱池管理                                              │
│     - 批量创建临时邮箱，持久化存储                                  │
│     - 状态管理: available | registered | verified | consumed        │
│     - 前端可查看、选择、删除邮箱                                    │
│                                                                      │
│  🖥️ 模式 2: 前端可视化调试（CDP 模式）【优先完善】                 │
│     - 从邮箱池选择临时邮箱                                          │
│     - 退出上一个账号的登录                                          │
│     - 自动登录 GPT + 自动化验证                                     │
│     - **有窗口可视化**（CDP 连接已打开的浏览器）                    │
│     - 验证码自动从临时邮箱获取                                      │
│     - 用户能实时看到浏览器操作                                      │
│                                                                      │
│  🚀 模式 3: 无头批量（Camoufox）                                    │
│     a) 临时邮箱账号（全自动）                                       │
│        - 从邮箱池选择（未注册 GPT 的）                              │
│        - 全自动注册 GPT + 验证                                      │
│        - 验证码自动获取                                             │
│        - 成功后退出登录，继续下一个                                 │
│                                                                      │
│     b) 自有邮箱账号（需手动输入验证码）                             │
│        - 用户输入自有邮箱（如 Gmail）+ 密码                         │
│        - Camoufox 有窗口（headless=false）                          │
│        - GPT 验证码发到用户邮箱，需手动输入                         │
│        - SheerID 链接发到临时邮箱，自动点击                         │
│        - **也消耗临时邮箱**（用于 SheerID 表单）                    │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 关键理解

**⚠️ 所有模式都消耗临时邮箱！**

| 模式 | GPT 登录邮箱 | SheerID 表单邮箱 | 验证码获取 |
|------|-------------|-----------------|-----------|
| 模式 2（CDP） | 临时邮箱 | 临时邮箱 | 自动 |
| 模式 3a（临时邮箱） | 临时邮箱 | 临时邮箱 | 自动 |
| 模式 3b（自有邮箱） | 自有邮箱 | **临时邮箱** | GPT验证码手动，SheerID自动 |

---

## 🗑️ 文件清理确认

### 已确认保留

| 文件 | 原因 |
|------|------|
| `.env.env.backup` | sync_env.py 的备份，需要保留 |
| `关于一些项目逻辑完善` | CF 盾讨论，有时会遇到，先留着 |
| `run_verify.py` | CDP 模式独立脚本，之前能用，需完善 |

### 代码文件状态（已确认）

| 文件 | 状态 | 说明 |
|------|------|------|
| `app.py` | ✅ 核心 | Flask 主应用 |
| `database.py` | ✅ 核心 | PostgreSQL 数据库 |
| `config.py` | ✅ 核心 | 配置管理 |
| `email_manager.py` | ✅ 核心 | 邮箱验证码/链接 |
| `email_pool.py` | ✅ 核心 | 邮箱池管理 |
| `proxy_manager.py` | ✅ 核心 | 代理池管理 |
| `profile_manager.py` | ✅ 核心 | Profile 持久化 |
| `veteran_data.py` | ✅ 核心 | BIRLS 数据处理 |
| `automation/camoufox_verify.py` | ✅ 核心 | Camoufox 无头验证 |
| `run_verify.py` | ✅ 保留 | CDP 模式脚本，需完善 |
| `browser_worker.py` | ⚠️ 废弃 | 早期版本，可移到 deprecated/ |
| `account_manager.py` | ⚠️ 废弃 | 已被 database.py 替代 |
| `check_*.py, fix_*.py` | ✅ 保留 | 工具脚本 |

---

## ✅ 待完成功能清单（按优先级）

### 🔴 高优先级

| # | 功能 | 状态 | 说明 |
|---|------|------|------|
| 1 | **CDP 模式完善** | ❌ | 前端可视化调试，之前能跑两个后不行了 |
| 2 | 代理管理前端修复 | ❌ | 解析/上传返回 0 |
| 3 | 退出上一个账号逻辑 | ❌ | 新任务前自动退出 |
| 4 | Status 字段动态检测 | ❌ | 有些页面有有些没有 |

### 🟡 中优先级

| # | 功能 | 状态 | 说明 |
|---|------|------|------|
| 5 | 代理池轮换策略 | ❌ | 按顺序轮流，一个账号一个代理 |
| 6 | 会话记录合并 | ❌ | 合并两个文件，新建标准文件 |
| 7 | PLAN.md 添加 TODO | ❌ | 明确的 TODO 列表带优先级 |

### 🟢 低优先级

| # | 功能 | 状态 | 说明 |
|---|------|------|------|
| 8 | Profile 清理工具 | ❌ | 前端一键删除（重置指纹） |
| 9 | 验证历史图表 | ❌ | 可视化成功率等 |

---

## 🔧 代理策略（用户确认）

```
代理分配规则：
1. 按顺序轮流分配
2. 一个账号一个代理
3. 直到成功验证通过
4. 或此代理不可用 → 轮换下一个
```

---

## 📄 文档处理

### 会话记录处理

用户确认：
- `上次会话记录.md` 和 `会话记录总阶.md` **合并**
- 删除这两个，新建一个标准的
- 内容：下个会话该做的事、已固化的策略、新增的需求

### CLAUDE.md 更新

- 删除 55-99 行的过时会话总结
- 保留核心规则和流程说明

---

## 🎯 开发流程（固化）

用户确认的流程：

```
1. 用户已启动 Chrome（start-chrome-devtools.bat）
2. Claude 直接接管，不要清理已启动的环境
3. 启动 Flask（python app.py）
4. 接管浏览器，查看前端
5. 测试功能，发现问题
6. 修复逻辑
7. 更新文档

⚠️ 不要每次都重启 Chrome，用户已经启动好了
```

---

## ❓ 已澄清问题

| 问题 | 答案 |
|------|------|
| 主流程优先级？ | CDP 模式优先 → 批量模式 → Camoufox |
| .env 策略？ | 放一起，默认值用最优解 |
| 会话记录处理？ | 合并删除，新建标准文件 |
| 代理分配？ | 按顺序轮流，一个账号一个 |
| PLAN.md 需要 TODO？ | 是，带优先级 |

---

## 📊 下一步行动
确保没有遗漏todo  因为CLAUDE.md 55-99  是我新提出的问题

### 立即执行

1. ✅ 更新 PROJECT_AUDIT.md（本文件）
2. ⬜ 清理 CLAUDE.md 55-99 行过时内容
3. ⬜ 合并会话记录文件
4. ⬜ 修复 CDP 模式（优先）

### 后续任务

5. ⬜ 修复代理管理前端
6. ⬜ 完善代理轮换策略
7. ⬜ 废弃文件移到 deprecated/

---

_审查更新完成，等待执行。_
